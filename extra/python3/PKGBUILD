# Description: Next generation of the python high-level scripting language
# URL:         
# Maintainer:  Emmett1, emmett1 dot 2miligrams at gmail dot com
# Depends on:  libffi

pkgname=python3
pkgver=3.11.0
pkgrel=3
arch=('x86_64')
extraver=a3
depends=('sqlite3' 'expat' 'libffi')
source=(https://www.python.org/ftp/python/$pkgver/Python-${pkgver}${extraver}.tar.xz)

prepare() {
	cd Python-${pkgver}${extraver}

	rm -rf Modules/expat
	rm -rf Modules/_ctypes/{darwin,libffi}
	rm -rf Modules/_decimal/libmpdec
}

build() {
        cd Python-${pkgver}${extraver}

        ./configure					\
		--prefix=/usr				\
		--enable-shared				\
		--with-system-expat			\
		--with-system-ffi			\
		--with-system-expat			\
		--with-system-libmpdec			\
		--enable-loadable-sqlite-extensions	\
		--without-ensurepip			\
		--with-tzpath=/usr/shared/zoneinfo	\

        make
}

package() {
        cd Python-${pkgver}${extraver}

	sed -i 's/^all:.*$/all: build_all/' Makefile

        make DESTDIR=$pkgdir install
	ln -sf /usr/bin/python3 $pkgdir/usr/bin/python
}
