pkgname=spirv-tools
pkgver=2021.3
pkgrel=1
arch=('x86_64')
makedepends=('cmake' 'python3' 'git' 'ninja')
source=("git+https://github.com/KhronosGroup/SPIRV-Tools.git#tag=v$pkgver"
	"git+https://github.com/KhronosGroup/SPIRV-Headers.git")

prepare() {
	cd SPIRV-Tools

	rm -rf build && mkdir -p build
}

build() {
	cd SPIRV-Tools/build

	cmake ..			\
	-GNinja				\
	-D CMAKE_INSTALL_PREFIX=/usr	\
	-D CMAKE_INSTALL_LIBDIR=/usr/lib	\
	-D CMAKE_BUILD_TYPE=Release	\
	-D SPIRV_WERROR=Off		\
	-D BUILD_SHARED_LIBS=ON		\
	-D SPIRV_TOOLS_BUILD_STATIC=ON	\
	-D SPIRV-Headers_SOURCE_DIR=$srcdir/SPIRV-Headers

	ninja
}

package() {
	cd SPIRV-Tools/build

	DESTDIR=$pkgdir ninja install
}
