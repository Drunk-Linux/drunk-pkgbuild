pkgname=coreutils
pkgver=9.0
pkgrel=1
pkgdesc='The basic file, shell and text manipulation utilities of the GNU operating system'
arch=('aarch64')
license=('GPL3')
url='https://www.gnu.org/software/coreutils/'
depends=('glibc')
source=("https://ftp.gnu.org/gnu/$pkgname/$pkgname-$pkgver.tar.xz"
        '01-fix-fs72253.patch')

prepare() {
	cd $pkgname-$pkgver
	# apply patch from the source array (should be a pacman feature)
	local filename
	for filename in "${source[@]}"; do
		if [[ "$filename" =~ \.patch$ ]]; then
			echo "Applying patch ${filename##*/}"
			patch -Np1 -i "$srcdir/${filename##*/}"
		fi
	done
}

build() {
	cd $pkgname-$pkgver

	./configure \
	--host=aarch64-linux-gnu \
	--prefix=/usr \
	--libexecdir=/usr/lib \
	--enable-no-install-program=groups,hostname,kill,uptime

	make
}

package() {
	cd $pkgname-$pkgver
	make DESTDIR="$pkgdir" install

	# Compatability for hardcoded shit that needs cp, echo, cat, rm at /bin
	mkdir -p $pkgdir/bin
	cd $pkgdir/bin
	cp -f ../usr/bin/* .
}
