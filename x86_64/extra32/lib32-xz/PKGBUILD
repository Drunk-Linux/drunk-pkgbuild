pkgname=lib32-xz
rpkgname=xz
pkgver=5.2.5
pkgrel=1
arch=('x86_64')
source=(https://tukaani.org/$rpkgname/$rpkgname-$pkgver.tar.xz)

build() {
        cd $rpkgname-$pkgver

	export CC="gcc -m32"
	export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
	export CFLAGS="$CFLAGS -Wno-format-truncation"

        ./configure		\
	--prefix=/usr		\
	--libdir=/usr/lib32	\
	--disable-rpath

        make
}

package() {
        cd $rpkgname-$pkgver
        make DESTDIR=$pkgdir install

        mkdir -pv $pkgdir/{bin,lib32}
        mv -v   $pkgdir/usr/bin/{lzma,unlzma,lzcat,xz,unxz,xzcat} $pkgdir/bin
        mv -v $pkgdir/usr/lib32/liblzma.so.* $pkgdir/lib32
        ln -svf ../../lib32/$(readlink $pkgdir/usr/lib32/liblzma.so) $pkgdir/usr/lib32/liblzma.so

	rm -rf "${pkgdir}"/usr/{bin,include,share}
}
