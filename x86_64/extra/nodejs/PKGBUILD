pkgname=nodejs
pkgver=17.3.0
pkgrel=1
arch=('x86_64')
depends=(which icu libuv)
source=(https://nodejs.org/dist/v$pkgver/node-v$pkgver.tar.xz
	allow-py3.11.patch)

prepare() {
	cd node-v$pkgver

	# Patch nodejs to allow usage of python-3.11
	patch -Np0 -i ../allow-py3.11.patch
}

build() {
	cd node-v$pkgver

	./configure			\
	--prefix=/usr			\
	--shared-libuv			\
	--shared-zlib			\
	--with-intl=system-icu

	make
}

package() {
	cd node-v$pkgver

	make DESTDIR=$pkgdir install
}
